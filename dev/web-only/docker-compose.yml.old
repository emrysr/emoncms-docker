# Base docker compose, added to by docker-compose.override or docker-compose.prod. See Readme.md

version: '2.1'

services:
  # PHP & apache container using offical Docker PHP iamge
  web:
    env_file:
      - ../default.docker-env
      - ./emoncms.env
    # If pre-built image from docker hub exists then use that (docker pull openenergymonitor/emoncms:latest) if not Buildcontainer see Dockerfile
    image: openenergymonitor/emoncms:10.1.13
    # build: ../Dockerfile
    # volumes:
    #   - emon-phpfina:/var/opt/emoncms/phpfina/
    #   - emon-phptimeseries:/var/opt/emoncms/phptimeseries/
    #   - emon-cms:/var/www/emoncms/
    #   - emon-log:/var/log/emoncms/
    #   - /home/emrys/DocumeSnts/emoncms2:/var/www/emoncms/
    working_dir: /var/www/emoncms/
    expose:
        - "80"
    ports:
        - 88:80
    environment:
        - LOG_LEVEL=1
        - MQTT_ENABLED = true
        - MQTT_HOST = mqtt
        - REDIS_ENABLED = false

    command: ["/var/www/emoncms/scripts/log-to-stout.sh&&","/usr/sbin/apachectl","-D","FOREGROUND"]

# volumes:
    # emon-phpfina:
    # emon-phptimeseries:
    # emon-log:
    # emon-cms:   
